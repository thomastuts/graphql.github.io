<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Wrapping a REST API in GraphQL | GraphQL</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="GraphQL | A data query language and runtime"><meta property="og:type" content="website"><meta property="og:url" content="http://graphql.org/"><meta property="og:description" content="A data query language and runtime"><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"><link rel="shortcut icon" href="/img/favicon.png"><link rel="stylesheet" href="/css/graphql.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/"><img class="nav-logo" src="/img/logo.svg" width="40" height="40">GraphQL</a><div class="nav-site-wrapper"><ul class="nav-site nav-site-internal"><li><a href="/docs/getting-started/" class="">Docs</a></li><li><a href="/blog/" class="active">Blog</a></li><li><a href="/help/" class="">Help</a></li><li><a href="/code/" class="">Code</a></li></ul><div class="algolia-search-wrapper"><input id="algolia-doc-search" type="text" placeholder="Search docs..."></div><ul class="nav-site nav-site-external"><li><a href="http://facebook.github.io/graphql/" target="_blank" class="">Spec</a></li></ul></div></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Recent Posts</h3><ul><li><a href="/blog/rest-api-graphql-wrapper/">Wrapping a REST API in GraphQL</a></li><li><a href="/blog/mocking-with-graphql/">Mocking your server is easy with GraphQL</a></li><li><a href="/blog/subscriptions-in-graphql-and-relay/">Subscriptions in GraphQL and Relay</a></li><li><a href="/blog/graphql-a-query-language/">GraphQL: A data query language</a></li></ul></div></div><div class="inner-content"><h1>Wrapping a REST API in GraphQL</h1><p>5/2/2016 by Steven Luscher</p><hr><div><p>Time and time again I hear the same aspiration from front-end web and mobile developers: they&#x27;re eager to reap the developer efficiency gains offered by new technologies like Relay and GraphQL, but they have years of momentum behind their existing REST API. Without data that clearly demonstrates the benefits of switching, they find it hard to justify an additional investment in GraphQL infrastructure.</p><p>In this post I will outline a rapid, low-investment method that you can use to stand up a GraphQL endpoint atop an existing REST API, using JavaScript alone. No backend developers will be harmed during the making of this blog post.</p><h2><a class="anchor" name="a-client-side-rest-wrapper"></a>A client-side REST wrapper <a class="hash-link" href="#a-client-side-rest-wrapper">#</a></h2><p>We&#x27;re going to create a <em>GraphQL schema</em> – a type system that describes your universe of data – that wraps calls to your existing REST API. This schema will receive and resolve GraphQL queries all on the client side. This architecture features some inherent performance flaws, but is fast to implement and requires no server changes.</p><p>Imagine a REST API that exposes a <code>/people/</code> endpoint through which you can browse <code>Person</code> models and their associated friends.</p><p><img src="/img/blog/20160502-rest-api-graphql-wrapper/rest-api-people.png" alt="A REST API that exposes an index of people" title="A REST API that exposes an index of people"></p><p>We will build a GraphQL that models people and their attributes (like <code>first_name</code> and <code>email</code>) as well as their association to other people through friendships.</p><h3><a class="anchor" name="installation"></a>Installation <a class="hash-link" href="#installation">#</a></h3><p>First we&#x27;ll need a set of schema building tools, and a custom Relay network layer that routes queries to a client-resident schema rather than a network endpoint.</p><pre class="prism language-javascript">
npm install <span class="token operator">--</span>save graphql graphql<span class="token operator">-</span>relay relay<span class="token operator">-</span>local<span class="token operator">-</span>schema</pre><h3><a class="anchor" name="building-the-schema"></a>Building the schema <a class="hash-link" href="#building-the-schema">#</a></h3><p>At the end of the process, we will want to export a <code>GraphQLSchema</code> that we can use to resolve queries.</p><pre class="prism language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  GraphQLSchema<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;graphql&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  query<span class="token punctuation">:</span> QueryType<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>At the root of all great schemas is a type called <code>query</code> whose definition we have specified as <code>QueryType</code>. Let&#x27;s build <code>QueryType</code> now – a type on which we will define all the possible things one might want to fetch.</p><p>To replicate all of the functionality of our REST API, let&#x27;s expose two fields:</p><ul><li>an <code>allPeople</code> field – analogous to <code>/people/</code></li><li>a <code>person(id: String!)</code> field – analogous to <code>/people/{ID}/</code></li></ul><p>Each field will consist of a return type, optional argument definitions, and a JavaScript method that resolves the data being queried for.</p><pre class="prism language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  GraphQLNonNull<span class="token punctuation">,</span>
  GraphQLObjectType<span class="token punctuation">,</span>
  GraphQLString<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;graphql&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> QueryType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLObjectType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&#x27;Query&#x27;</span><span class="token punctuation">,</span>
  description<span class="token punctuation">:</span> <span class="token string">&#x27;The root of all... queries&#x27;</span><span class="token punctuation">,</span>
  fields<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    allPeople<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLList</span><span class="token punctuation">(</span>PersonType<span class="token punctuation">)</span><span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>root<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span spellcheck="true" class="token comment">// Fetch the index of people from the REST API,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    person<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> PersonType<span class="token punctuation">,</span>
      args<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        id<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLNonNull</span><span class="token punctuation">(</span>GraphQLString<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>root<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span spellcheck="true" class="token comment">// Fetch the person with ID `args.id`,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>Let&#x27;s leave the resolvers as a sketch for now, and move on to defining <code>PersonType</code>.</p><pre class="prism language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  GraphQLList<span class="token punctuation">,</span>
  GraphQLObjectType<span class="token punctuation">,</span>
  GraphQLString<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;graphql&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> PersonType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLObjectType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&#x27;Person&#x27;</span><span class="token punctuation">,</span>
  description<span class="token punctuation">:</span> <span class="token string">&#x27;Somebody that you used to know&#x27;</span><span class="token punctuation">,</span>
  fields<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>person<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> person<span class="token punctuation">.</span>first_name<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    lastName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>person<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> person<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    email<span class="token punctuation">:</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">}</span><span class="token punctuation">,</span>
    id<span class="token punctuation">:</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">}</span><span class="token punctuation">,</span>
    username<span class="token punctuation">:</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">}</span><span class="token punctuation">,</span>
    friends<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLList</span><span class="token punctuation">(</span>PersonType<span class="token punctuation">)</span><span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>person<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span spellcheck="true" class="token comment">// Fetch the friends with the URLs `person.friends`,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>Note two things about the definition of <code>PersonType</code>. Firstly, we have not supplied a resolver for <code>email</code>, <code>id</code>, or <code>username</code>. The default resolver simply accesses the property of the root object that has the same name as the field. This works everywhere except where the property names do not match the field name (eg. the field <code>firstName</code> does not match the <code>first_name</code> property of the response object from the REST API) or where accessing the property would not yield the object that we want (eg. we want a list of person objects for the <code>friends</code> field, not a list of URLs).</p><p>Now, let&#x27;s write resolvers that fetch people from the REST API. Luckily, your implementation of <code>resolve()</code> can return either a value or a <code>Promise</code> that resolves to a value. We&#x27;re going to take advantage of this to fire off an HTTP request to the REST API that eventually resolves to a JavaScript object that conforms to <code>PersonType</code>.</p><pre class="prism language-javascript">
<span class="token keyword">const</span> BASE_URL <span class="token operator">=</span> <span class="token string">&#x27;https://myapp.com/&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getResponseByURL</span><span class="token punctuation">(</span>relativeURL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>BASE_URL<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>relativeURL<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getPeopleByURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">getResponseByURL</span><span class="token punctuation">(</span><span class="token string">&#x27;/people/&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>json <span class="token operator">=</span><span class="token operator">&gt;</span> json<span class="token punctuation">.</span>people<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getPersonByURL</span><span class="token punctuation">(</span>relativeURL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">getResponseByURL</span><span class="token punctuation">(</span>relativeURL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>json <span class="token operator">=</span><span class="token operator">&gt;</span> json<span class="token punctuation">.</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> PersonType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLObjectType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span spellcheck="true" class="token comment">/* ... */</span>
  fields<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span spellcheck="true" class="token comment">/* ... */</span>
    friends<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLList</span><span class="token punctuation">(</span>PersonType<span class="token punctuation">)</span><span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>person<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> person<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>getPersonByURL<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> QueryType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLObjectType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span spellcheck="true" class="token comment">/* ... */</span>
  fields<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    allPeople<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLList</span><span class="token punctuation">(</span>PersonType<span class="token punctuation">)</span><span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>root<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">getPeopleByURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    person<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> PersonType<span class="token punctuation">,</span>
      args<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        id<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLNonNull</span><span class="token punctuation">(</span>GraphQLString<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>root<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">getPersonByURL</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/people/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>args<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:400px;"></div><div class="line-highlight" style="height:20px;top:600px;"></div><div class="line-highlight" style="height:20px;top:740px;"></div></pre><p>And here we have it – a complete first-pass at the schema:</p><pre class="prism language-javascript">
<span spellcheck="true" class="token comment">// ./schema.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  GraphQLList<span class="token punctuation">,</span>
  GraphQLNonNull<span class="token punctuation">,</span>
  GraphQLObjectType<span class="token punctuation">,</span>
  GraphQLSchema<span class="token punctuation">,</span>
  GraphQLString<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;graphql&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> BASE_URL <span class="token operator">=</span> <span class="token string">&#x27;https://myapp.com/&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getResponseByURL</span><span class="token punctuation">(</span>relativeURL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>BASE_URL<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>relativeURL<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getPeopleByURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">getResponseByURL</span><span class="token punctuation">(</span><span class="token string">&#x27;/people/&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>json <span class="token operator">=</span><span class="token operator">&gt;</span> json<span class="token punctuation">.</span>people<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getPersonByURL</span><span class="token punctuation">(</span>relativeURL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">getResponseByURL</span><span class="token punctuation">(</span>relativeURL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>json <span class="token operator">=</span><span class="token operator">&gt;</span> json<span class="token punctuation">.</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> PersonType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLObjectType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&#x27;Person&#x27;</span><span class="token punctuation">,</span>
  description<span class="token punctuation">:</span> <span class="token string">&#x27;Somebody that you used to know&#x27;</span><span class="token punctuation">,</span>
  fields<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>person<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> person<span class="token punctuation">.</span>first_name<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    lastName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>person<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> person<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    email<span class="token punctuation">:</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">}</span><span class="token punctuation">,</span>
    id<span class="token punctuation">:</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">}</span><span class="token punctuation">,</span>
    username<span class="token punctuation">:</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">}</span><span class="token punctuation">,</span>
    friends<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLList</span><span class="token punctuation">(</span>PersonType<span class="token punctuation">)</span><span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>person<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> person<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>getPersonByURL<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> QueryType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLObjectType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&#x27;Query&#x27;</span><span class="token punctuation">,</span>
  description<span class="token punctuation">:</span> <span class="token string">&#x27;The root of all... queries&#x27;</span><span class="token punctuation">,</span>
  fields<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    allPeople<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLList</span><span class="token punctuation">(</span>PersonType<span class="token punctuation">)</span><span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>root<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">getPeopleByURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    person<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> PersonType<span class="token punctuation">,</span>
      args<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        id<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLNonNull</span><span class="token punctuation">(</span>GraphQLString<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>root<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">getPersonByURL</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/people/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>args<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  query<span class="token punctuation">:</span> QueryType<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><h3><a class="anchor" name="using-a-client-side-schema-with-relay"></a>Using a client-side schema with Relay <a class="hash-link" href="#using-a-client-side-schema-with-relay">#</a></h3><p>Normally, Relay will send its GraphQL queries to a server over HTTP. We can inject <a href="https://github.com/taion/" target="_blank">@taion</a>&#x27;s custom <code>relay-local-schema</code> network layer to resolve queries using the schema we just built. Put this code wherever it&#x27;s guaranteed to be executed before you mount your Relay app.</p><pre class="prism language-javascript">
<span class="token keyword">import</span> RelayLocalSchema <span class="token keyword">from</span> <span class="token string">&#x27;relay-local-schema&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> schema <span class="token keyword">from</span> <span class="token string">&#x27;./schema&#x27;</span><span class="token punctuation">;</span>

Relay<span class="token punctuation">.</span><span class="token function">injectNetworkLayer</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">RelayLocalSchema<span class="token punctuation">.</span>NetworkLayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>schema<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>And that&#x27;s that. Relay will send all of its queries to your custom client-resident schema, which will in turn resolve them by making calls to your existing REST API.</p><h2><a class="anchor" name="a-server-side-rest-wrapper"></a>A server-side REST wrapper <a class="hash-link" href="#a-server-side-rest-wrapper">#</a></h2><p>The client-side REST API wrapper demonstrated above should help you get up and running quickly so that you can prove out a Relay version of your app, or part of your app. A good next step is to move the schema from the client side to the server side to eliminate certain classes of network latency problems and to give you more power to cache responses.</p><p>Take the next 10 minutes to watch me build a server side version of the GraphQL wrapper above using Node and Express.</p><div><iframe id="ytplayer" type="text/html" width="640" height="390"
  src="http://www.youtube.com/embed/UBGzsb2UkeY?autoplay=0&origin=http://graphql.org&start=900"
  frameborder="0"></iframe>

</div><h2><a class="anchor" name="bonus-round"></a>Bonus round <a class="hash-link" href="#bonus-round">#</a></h2><p>Let&#x27;s go further.</p><h3><a class="anchor" name="a-truly-relay-compliant-schema"></a>A truly Relay compliant schema <a class="hash-link" href="#a-truly-relay-compliant-schema">#</a></h3><p>The schema we developed above will work for Relay up until a certain point – the point at which you ask Relay to refetch data for records you&#x27;ve already downloaded. Relay&#x27;s refetching subsystem relies on your GraphQL schema exposing a special field that can fetch any entity in your data universe by guid. We call this the <em>node interface</em>.</p><p>To expose a node interface requires that you do two things: offer a <code>node(id: String!)</code> field at the root of the query, and switch all of your ids over to guids.</p><h4><a class="anchor" name="global-ids"></a>Global ids <a class="hash-link" href="#global-ids">#</a></h4><p>First, let&#x27;s change the <code>id</code> field of <code>PersonType</code> into a guid. To do this, we&#x27;ll use the <code>globalIdField</code> helper from <code>graphql-relay</code>.</p><pre class="prism language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  globalIdField<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;graphql-relay&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> PersonType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLObjectType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&#x27;Person&#x27;</span><span class="token punctuation">,</span>
  description<span class="token punctuation">:</span> <span class="token string">&#x27;Somebody that you used to know&#x27;</span><span class="token punctuation">,</span>
  fields<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span spellcheck="true" class="token comment">/* ... */</span>
    id<span class="token punctuation">:</span> <span class="token function">globalIdField</span><span class="token punctuation">(</span><span class="token string">&#x27;Person&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span spellcheck="true" class="token comment">/* ... */</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>Behind the scenes <code>globalIdField</code> returns a field definition that resolves <code>id</code> to a <code>GraphQLString</code> by hashing together the typename <code>&#x27;Person&#x27;</code> and the id returned by the REST API. For instance, the guid of the person with id <code>&#x27;123&#x27;</code> can be thought of as <code>base64(&#x27;Person:123&#x27;)</code>.</p><h4><a class="anchor" name="the-node-field"></a>The node field <a class="hash-link" href="#the-node-field">#</a></h4><p>Another set of helpers from <code>graphql-relay</code> will give us a hand developing the node field. Your job is to supply the helper two functions:</p><ul><li>One function that can resolve an object given a guid</li><li>One function that can resolve a typename given an object</li></ul><pre class="prism language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  fromGlobalId<span class="token punctuation">,</span>
  nodeDefinitions<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;graphql-relay&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token punctuation">{</span>nodeInterface<span class="token punctuation">,</span> nodeField<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">nodeDefinitions</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span>globalId<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> <span class="token punctuation">{</span>type<span class="token punctuation">,</span> id<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">fromGlobalId</span><span class="token punctuation">(</span>globalId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&#x27;Person&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">getPersonByURL</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/people/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&#x27;username&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&#x27;Person&#x27;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>The object-to-typename resolver above is no marvel of engineering, but you get the idea.</p><p>Next, we simply need to add the <code>nodeInterface</code> and the <code>nodeField</code> to our schema. A complete example follows:</p><pre class="prism language-javascript">
<span spellcheck="true" class="token comment">// ./schema.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  GraphQLList<span class="token punctuation">,</span>
  GraphQLNonNull<span class="token punctuation">,</span>
  GraphQLObjectType<span class="token punctuation">,</span>
  GraphQLSchema<span class="token punctuation">,</span>
  GraphQLString<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;graphql&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  fromGlobalId<span class="token punctuation">,</span>
  globalIdField<span class="token punctuation">,</span>
  nodeDefinitions<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;graphql-relay&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> BASE_URL <span class="token operator">=</span> <span class="token string">&#x27;https://myapp.com/&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getResponseByURL</span><span class="token punctuation">(</span>relativeURL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>BASE_URL<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>relativeURL<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getPeopleByURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">getResponseByURL</span><span class="token punctuation">(</span><span class="token string">&#x27;/people/&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>json <span class="token operator">=</span><span class="token operator">&gt;</span> json<span class="token punctuation">.</span>people<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getPersonByURL</span><span class="token punctuation">(</span>relativeURL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">getResponseByURL</span><span class="token punctuation">(</span>relativeURL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>json <span class="token operator">=</span><span class="token operator">&gt;</span> json<span class="token punctuation">.</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token punctuation">{</span>nodeInterface<span class="token punctuation">,</span> nodeField<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">nodeDefinitions</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span>globalId<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> <span class="token punctuation">{</span>type<span class="token punctuation">,</span> id<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">fromGlobalId</span><span class="token punctuation">(</span>globalId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&#x27;Person&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">getPersonByURL</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/people/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&#x27;username&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&#x27;Person&#x27;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> PersonType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLObjectType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&#x27;Person&#x27;</span><span class="token punctuation">,</span>
  description<span class="token punctuation">:</span> <span class="token string">&#x27;Somebody that you used to know&#x27;</span><span class="token punctuation">,</span>
  fields<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>person<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> person<span class="token punctuation">.</span>first_name<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    lastName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>person<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> person<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    email<span class="token punctuation">:</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">}</span><span class="token punctuation">,</span>
    id<span class="token punctuation">:</span> <span class="token function">globalIdField</span><span class="token punctuation">(</span><span class="token string">&#x27;Person&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    username<span class="token punctuation">:</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">}</span><span class="token punctuation">,</span>
    friends<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLList</span><span class="token punctuation">(</span>PersonType<span class="token punctuation">)</span><span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>person<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> person<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>getPersonByURL<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  interfaces<span class="token punctuation">:</span> <span class="token punctuation">[</span>nodeInterface<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> QueryType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLObjectType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&#x27;Query&#x27;</span><span class="token punctuation">,</span>
  description<span class="token punctuation">:</span> <span class="token string">&#x27;The root of all... queries&#x27;</span><span class="token punctuation">,</span>
  fields<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    allPeople<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLList</span><span class="token punctuation">(</span>PersonType<span class="token punctuation">)</span><span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>root<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">getPeopleByURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    node<span class="token punctuation">:</span> nodeField<span class="token punctuation">,</span>
    person<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> PersonType<span class="token punctuation">,</span>
      args<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        id<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLNonNull</span><span class="token punctuation">(</span>GraphQLString<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>root<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">getPersonByURL</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/people/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>args<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  query<span class="token punctuation">:</span> QueryType<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:560px;"></div><div class="line-highlight" style="height:20px;top:580px;"></div><div class="line-highlight" style="height:20px;top:600px;"></div><div class="line-highlight" style="height:20px;top:620px;"></div><div class="line-highlight" style="height:20px;top:640px;"></div><div class="line-highlight" style="height:20px;top:660px;"></div><div class="line-highlight" style="height:20px;top:680px;"></div><div class="line-highlight" style="height:20px;top:700px;"></div><div class="line-highlight" style="height:20px;top:720px;"></div><div class="line-highlight" style="height:20px;top:740px;"></div><div class="line-highlight" style="height:20px;top:760px;"></div><div class="line-highlight" style="height:20px;top:780px;"></div><div class="line-highlight" style="height:20px;top:800px;"></div><div class="line-highlight" style="height:20px;top:1100px;"></div><div class="line-highlight" style="height:20px;top:1240px;"></div><div class="line-highlight" style="height:20px;top:1460px;"></div></pre><h3><a class="anchor" name="taming-pathological-queries"></a>Taming pathological queries <a class="hash-link" href="#taming-pathological-queries">#</a></h3><p>Consider the following friends-of-friends-of-friends query:</p><pre class="prism language-javascript">
query <span class="token punctuation">{</span>
  <span class="token function">person</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    firstName
    friends <span class="token punctuation">{</span>
      firstName
      friends <span class="token punctuation">{</span>
        firstName
        friends <span class="token punctuation">{</span>
          firstName
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre><p>The schema we created above will generate multiple round trips to the REST API for the same data.</p><p><img src="/img/blog/20160502-rest-api-graphql-wrapper/pathological-query.png" alt="Duplicate queries to the REST API" title="Duplicate queries to the REST API"></p><p>We created a library called DataLoader to help tame these sorts of queries.</p><h4><a class="anchor" name="installation"></a>Installation <a class="hash-link" href="#installation">#</a></h4><pre class="prism language-javascript">
npm install <span class="token operator">--</span>save dataloader</pre><p>As a special note, make sure that your runtime offers native or polyfilled versions of <code>Promise</code> and <code>Map</code>. Read more <a href="https://github.com/facebook/dataloader#getting-started" target="_blank">at the DataLoader site</a>.</p><h4><a class="anchor" name="creating-a-data-loader"></a>Creating a data loader <a class="hash-link" href="#creating-a-data-loader">#</a></h4><p>To create a <code>DataLoader</code> you supply a method that can resolve a list of objects given a list of keys. In our example, the keys are URLs at which we access a REST API.</p><pre class="prism language-javascript">
<span class="token keyword">const</span> personLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataLoader</span><span class="token punctuation">(</span>
  urls <span class="token operator">=</span><span class="token operator">&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>urls<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>getPersonByURL<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>If this data loader sees a key more than once in its lifetime, it will return a memoized version of the response.</p><h4><a class="anchor" name="loading-data"></a>Loading data <a class="hash-link" href="#loading-data">#</a></h4><p>We can make use of the <code>load()</code> and <code>loadMany()</code> methods on <code>personLoader</code> to load URLs without fear of hitting the REST API more than once per URL. A complete example follows:</p><pre class="prism language-javascript">
<span spellcheck="true" class="token comment">// ./schema.js</span>
<span class="token keyword">import</span> DataLoader <span class="token keyword">from</span> <span class="token string">&#x27;dataloader&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  GraphQLList<span class="token punctuation">,</span>
  GraphQLNonNull<span class="token punctuation">,</span>
  GraphQLObjectType<span class="token punctuation">,</span>
  GraphQLSchema<span class="token punctuation">,</span>
  GraphQLString<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;graphql&#x27;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  fromGlobalId<span class="token punctuation">,</span>
  globalIdField<span class="token punctuation">,</span>
  nodeDefinitions<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;graphql-relay&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> BASE_URL <span class="token operator">=</span> <span class="token string">&#x27;https://myapp.com/&#x27;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getResponseByURL</span><span class="token punctuation">(</span>relativeURL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>BASE_URL<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>relativeURL<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=</span><span class="token operator">&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getPeopleByURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">getResponseByURL</span><span class="token punctuation">(</span><span class="token string">&#x27;/people/&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>json <span class="token operator">=</span><span class="token operator">&gt;</span> json<span class="token punctuation">.</span>people<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getPersonByURL</span><span class="token punctuation">(</span>relativeURL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">getResponseByURL</span><span class="token punctuation">(</span>relativeURL<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>json <span class="token operator">=</span><span class="token operator">&gt;</span> json<span class="token punctuation">.</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> personLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataLoader</span><span class="token punctuation">(</span>
  urls <span class="token operator">=</span><span class="token operator">&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>urls<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>getPersonByURL<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token punctuation">{</span>nodeInterface<span class="token punctuation">,</span> nodeField<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">nodeDefinitions</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span>globalId<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> <span class="token punctuation">{</span>type<span class="token punctuation">,</span> id<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">fromGlobalId</span><span class="token punctuation">(</span>globalId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&#x27;Person&#x27;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> personLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/people/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&#x27;username&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">&#x27;Person&#x27;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> PersonType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLObjectType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&#x27;Person&#x27;</span><span class="token punctuation">,</span>
  description<span class="token punctuation">:</span> <span class="token string">&#x27;Somebody that you used to know&#x27;</span><span class="token punctuation">,</span>
  fields<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>person<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> person<span class="token punctuation">.</span>first_name<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    lastName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>person<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> person<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    email<span class="token punctuation">:</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">}</span><span class="token punctuation">,</span>
    id<span class="token punctuation">:</span> <span class="token function">globalIdField</span><span class="token punctuation">(</span><span class="token string">&#x27;Person&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    username<span class="token punctuation">:</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">}</span><span class="token punctuation">,</span>
    friends<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLList</span><span class="token punctuation">(</span>PersonType<span class="token punctuation">)</span><span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>person<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> personLoader<span class="token punctuation">.</span><span class="token function">loadMany</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>friends<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  interfaces<span class="token punctuation">:</span> <span class="token punctuation">[</span>nodeInterface<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> QueryType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLObjectType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&#x27;Query&#x27;</span><span class="token punctuation">,</span>
  description<span class="token punctuation">:</span> <span class="token string">&#x27;The root of all... queries&#x27;</span><span class="token punctuation">,</span>
  fields<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    allPeople<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLList</span><span class="token punctuation">(</span>PersonType<span class="token punctuation">)</span><span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>root<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">getPeopleByURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    node<span class="token punctuation">:</span> nodeField<span class="token punctuation">,</span>
    person<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> PersonType<span class="token punctuation">,</span>
      args<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        id<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLNonNull</span><span class="token punctuation">(</span>GraphQLString<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">(</span>root<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> personLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/people/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>args<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  query<span class="token punctuation">:</span> QueryType<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:740px;"></div><div class="line-highlight" style="height:20px;top:1280px;"></div><div class="line-highlight" style="height:20px;top:1680px;"></div></pre><p>Now, our pathological query produces the following nicely de-duped set of requests to the REST API:</p><p><img src="/img/blog/20160502-rest-api-graphql-wrapper/dataloader-query.png" alt="De-duped queries to the REST API" title="De-duped queries to the REST API"></p><h3><a class="anchor" name="query-planning-and-beyond"></a>Query planning and beyond <a class="hash-link" href="#query-planning-and-beyond">#</a></h3><p>Consider that your REST API might already offer configuration offers that let you eagerly load associations. Maybe to load a person and all of their direct friends you might hit the URL <code>/people/1/?include_friends</code>. To take advantage of this in your GraphQL schema you will need the ability to develop a resolution plan based on the structure of the query itself (eg. whether the <code>friends</code> field is part of the query or not).</p><p>For those interested in the current thinking around advanced resolution strategies, keep an eye on <a href="https://github.com/graphql/graphql-js/pull/304" target="_blank">pull request #304</a>.</p><h2><a class="anchor" name="thanks-for-reading"></a>Thanks for reading <a class="hash-link" href="#thanks-for-reading">#</a></h2><p>I hope that this demonstration has torn down some of the barriers between you and a functional GraphQL endpoint, and has inspired you to experiment with GraphQL and Relay on an existing project.</p></div></div></section><footer class="wrap"><div class="right">©2015 Facebook Inc.</div></footer></div><div id="fb-root"></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
            docsearch({
              apiKey: 'd103541f3e6041148aade2e746ed4d61',
              indexName: 'graphql',
              inputSelector: '#algolia-doc-search'
            });
          </script></body></html>